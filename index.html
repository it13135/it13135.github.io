<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>N-puzzle Solver</title>
  <meta name="description" content="N-puzzle solver">
  <meta name="author" content="Manolis Mimilidis">

  <link rel="stylesheet" href="/opengov/bootstrap/css/bootstrap.min.css">
  <style>
    td{
		width:60px;
		height: 60px;
		vertical-align: middle!important;
	}
	.table{
		width:auto!important;
	}
	.next {
	  height:100%;
	  width:100%;
	}
  table.center {
    margin-left:auto; 
    margin-right:auto;
  }
  body {text-align:center;}
  </style>
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <select id="selectno" onchange="mix();">
    <option>2</option>
    <option selected="selected">3</option>
    <option>4</option>
    <option>5</option>
    <option>6</option>
    <option>7</option>
    <option>8</option>
    <option>9</option>
    <option>10</option>
  </select>
  <button class="btn btn-primary" onclick="mix()">Ανακάτεψε</button>
  <div id="puzzle" class="container">
  </div>
  <div id="info">TEST</div>
  <script src="/opengov/jquery/jquery.min.js"></script>
  <script>
    var tiles = [];
	var empty = {col:0,row:0};
    function mix(){
      var no = $("#selectno").val(),
         col = 1,
           i,
           j;
	  empty.col = no - 1;
	  empty.row = no - 1;

      tiles = [];
       $("#puzzle").html("");
      for (i = 0; i < no; i++){
        for(j = 0; (j < no-1) || (j==no-1 && i<no-1); j++){
          tiles.push(i * no + j);
        }
      }
      shuffle(tiles);
	  var currentRow;
	  $("#puzzle").append($('<table />', {id:'puzzletable', class:"table table-condensed table-responsive table-bordered text-center center"}));
	  $("#puzzletable").append($('<tbody/>'));
	  $.each(tiles, function(i, item){
		  currentRow = Math.floor(i/no);
		  if (i%no === 0)
			  $("#puzzletable>tbody:last").append($('<tr />', {id:'tr'+currentRow}));
	      $("#tr"+currentRow).append($('<td />', {row:currentRow, col:i%no}));	  
		  $("td[col="+(i%no)+"][row="+currentRow+"]").append($('<button />', {class: 'btn btn-success next', text:item+1	}));
	    }
	  );
	  $("#tr"+currentRow).append($('<td />', {row:currentRow, col:no-1}));
	  fixnear();
    }
	function fixnear(){
	  $("td[col="+(empty.col)+"][row="+(empty.row-1)+"] button").removeClass("btn-success").addClass("btn-primary").bind("click", clickme);
	  $("td[col="+(empty.col-1)+"][row="+(empty.row)+"] button").removeClass("btn-success").addClass("btn-primary").bind("click", clickme);
	  $("td[col="+(empty.col)+"][row="+(empty.row+1)+"] button").removeClass("btn-success").addClass("btn-primary").bind("click", clickme);
	  $("td[col="+(empty.col+1)+"][row="+(empty.row)+"] button").removeClass("btn-success").addClass("btn-primary").bind("click", clickme);
	}
	function unfixnear(){
	  $("td[col="+(empty.col)+"][row="+(empty.row-1)+"] button").addClass("btn-success").removeClass("btn-primary").unbind("click");
	  $("td[col="+(empty.col-1)+"][row="+(empty.row)+"] button").addClass("btn-success").removeClass("btn-primary").unbind("click");
	  $("td[col="+(empty.col)+"][row="+(empty.row+1)+"] button").addClass("btn-success").removeClass("btn-primary").unbind("click");
	  $("td[col="+(empty.col+1)+"][row="+(empty.row)+"] button").addClass("btn-success").removeClass("btn-primary").unbind("click");
	}	
	function clickme(){
	  unfixnear();
	  var row=$(this).parent().attr("row");
	  var col=$(this).parent().attr("col");
	  var element = $(this).detach().appendTo($("td[col="+empty.col+"][row="+empty.row+"]"));
	  empty.col = parseInt(col);
	  empty.row = parseInt(row);
	  fixnear();
	}
    function shuffle(array) {
      var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  $("#info").text(array.join(", "));
  return array;
}
$(function() {
  mix();
});
</script>
</body>
</html>
